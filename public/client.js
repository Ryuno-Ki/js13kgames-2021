/**
 * This file is part of JS13kGames - SPACE.
 * Lido Space is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * Lido Space is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with Lido Space.  If not, see <https://www.gnu.org/licenses/>.
 */

var lido=function(e){"use strict";var t="Game not properly initialised!",n="addUser",o="keyUp",r="selectMode",i={avatars:[],edges:null,host:null,opponentsState:null,roleState:null,socket:null,socketState:null,spectatorsState:null};function a(e){if(null===i.socketState)throw new Error("HTML broken");i.socketState.textContent=e}function s(){a("Connected and waiting for opponent…")}function c(){a("Connection lost!")}function u(){a("Waiting for opponent…")}function l(){a("Connection error!")}var d={downTime:0,hostPoints:[],isPressed:!1,mode:null,name:null,opponentPoints:[],role:ROLE_UNKNOWN,startTime:0,upTime:0};function f(e){var n=e.role,r=e.opponents,s=e.spectators;d.role=n,n===ROLE_HOST&&(!function(e){var n=e.role,o=e.opponents,r=e.spectators;if(!i.opponentsState||!i.roleState||!i.spectatorsState)throw new Error(t);i.roleState.textContent=n,i.opponentsState.textContent=o.join(", "),i.spectatorsState.textContent=r.join(", ")}({role:n,opponents:r,spectators:s}),document.body.addEventListener("keydown",(function(e){"Space"===e.code&&(e.preventDefault(),d.isPressed||(d.downTime=(new Date).valueOf(),d.isPressed=!0))}),!1),document.body.addEventListener("keyup",(function(e){"Space"===e.code&&(e.preventDefault(),function(){d.upTime=(new Date).valueOf();var e=(d.upTime-d.downTime)/1e3;Number.isNaN(e)||i.socket.emit(o,{delta:e}),d.isPressed=!1}())}),!1)),n===ROLE_OPPONENT&&function(){if(!i.edges)throw new Error(t);document.body.addEventListener("keyup",(function(e){switch(e.code){case"ArrowUp":e.preventDefault(),i.socket.emit(o,{direction:0}),p();break;case"ArrowRight":e.preventDefault(),i.socket.emit(o,{direction:1}),p();break;case"ArrowDown":e.preventDefault(),i.socket.emit(o,{direction:2}),p();break;case"ArrowLeft":e.preventDefault(),i.socket.emit(o,{direction:3}),p()}}),!1)}(),a("Playing")}function p(){window.zzfx.apply(window,[,,350,,,.09,4,1.13,,6.9,,,,.9,,.5,,.93,.01,.18])}function w(e){var n=e.points,o=e.role;if(o===ROLE_HOST){if(null===i.host)throw new Error(t);var r=n.map((function(e){return e.join(",")})).join(" ");i.host.setAttribute("points",r)}if(o===ROLE_OPPONENT){if(!i.edges)throw new Error(t);var a=i.edges;console.log("Points",n),n.forEach((function(e,n){var o=a.children[2*n],r=a.children[2*n+1],i=e[e.length-1];if(console.log("Opponent",e,n,o,r),!o||!r)throw new Error(t);var s=i[0],c=i[1];o.setAttribute("cx",s),o.setAttribute("cy",c),d.opponentPoints.push([s,c]);var u=e.join(",");r.setAttribute("points",u)}))}}function m(e){var t,n,o=new URL(window.location.href);o.hash="#scene-"+e,window.history.pushState({},"",o.href),window.location.hash=o.hash,Array.from(document.querySelectorAll("section")).forEach((function(e){e.style.display="none"})),t=o.hash,(n=document.querySelector(t))&&(n.style.display=""),i.socket.emit("navigate",{scene:e})}function h(){d.hostPoints=[],i.socket=window.io({upgrade:!1,transports:["websocket"]}),function(e){e.host=function(){var e=document.getElementById("host");if(!e)throw new Error(t);return e}(),e.edges=function(){var e=document.getElementById("edges");if(!e)throw new Error(t);return e}(),e.socketState=function(){var e=document.getElementById("socketState");if(!e)throw new Error(t);return e}(),e.roleState=function(){var e=document.getElementById("role");if(!e)throw new Error(t);return e}(),e.opponentsState=function(){var e=document.getElementById("opponents");if(!e)throw new Error(t);return e}(),e.spectatorsState=function(){var e=document.getElementById("spectators");if(!e)throw new Error(t);return e}()}(i),function(){if(null===i.socket)throw new Error(t);i.socket.on("start",f),i.socket.on("sync",w),i.socket.on("end",u),i.socket.on("connect",s),i.socket.on("disconnect",c),i.socket.on("error",l)}(),d.startTime=(new Date).valueOf(),function(){var e=document.getElementById("user-form");if(!e)throw new Error(t);e.addEventListener("submit",(function(e){if(e.preventDefault(),!e.target)throw new Error(t);var o=new FormData(e.target).get("name");o?(d.name=String(o),console.log("State",d),i.socket.emit(n,{name:d.name}),m("match-form")):console.error("Show validation error")}))}(),function(){var e=document.getElementById("match-form");if(!e)throw new Error(t);e.addEventListener("submit",(function(e){if(e.preventDefault(),!e.target)throw new Error(t);var n=new FormData(e.target).get("mode");n?(d.mode=String(n),console.log("State",d),i.socket.emit(r,{mode:d.mode}),m("game")):console.error("Show validation error")}))}(),Array.from(document.querySelectorAll("a")).forEach((function(e){e.addEventListener("click",(function(t){var n=e.getAttribute("href");n&&(t.preventDefault(),m(n.slice("#scene-".length)))}),!1)})),m("title")}return e.app=function(){window.addEventListener("load",h,!1)},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
