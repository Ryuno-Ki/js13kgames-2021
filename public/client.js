/**
 * This file is part of JS13kGames - SPACE.
 * Lido Space is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * Lido Space is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with Lido Space.  If not, see <https://www.gnu.org/licenses/>.
 */

var lido=function(t){"use strict";var e={avatars:[],edges:null,host:null,opponentsState:null,roleState:null,socket:null,socketState:null,spectatorsState:null};function n(t){if(null===e.socketState)throw new Error("HTML broken");e.socketState.textContent=t}function o(){n("Connected and waiting for opponent…")}function r(){n("Connection lost!")}function i(){n("Waiting for opponent…")}function s(){n("Connection error!")}function a(t){console.log(t)}function c(){a("You lost")}var u={downTime:0,hostPoints:[],isPressed:!1,opponentPoints:[],role:ROLE_UNKNOWN,startTime:0,upTime:0};function p(){var t=[160,100],e=[].concat([t]);return u.hostPoints.forEach((function(n){var o,r=t[0],i=t[1],s=function(t){var e=t.radius,n=t.angle;return{x:e*Math.cos(n),y:e*Math.sin(n)}}({radius:130*Math.random(),angle:(o=360*n/13,o*Math.PI/180)}),a=s.x,c=s.y;e.push([r+a,i+c]),e.push([r,i])})),e.slice(-26)}function l(){if(null===e.host)throw new Error("Game not properly initialised!");var t=p().map((function(t){return t.join(",")})).join(" ");e.host.setAttribute("points",t)}function d(t){var o=t.role,r=t.opponents,i=t.spectators;u.role=o,function(t){var n=t.role,o=t.opponents,r=t.spectators;if(!e.opponentsState||!e.roleState||!e.spectatorsState)throw new Error("Bogus HTML");e.roleState.textContent=n,e.opponentsState.textContent=o+"",e.spectatorsState.textContent=r+""}({role:o,opponents:r,spectators:i}),o===ROLE_HOST&&(document.body.addEventListener("keydown",(function(t){"Space"===t.code&&(t.preventDefault(),u.isPressed||(u.downTime=(new Date).valueOf(),u.isPressed=!0))}),!1),document.body.addEventListener("keyup",(function(t){"Space"===t.code&&(t.preventDefault(),function(){u.upTime=(new Date).valueOf();var t=u.upTime-u.downTime;Number.isNaN(t/1e3)||(u.hostPoints.push((u.startTime-u.upTime)/1e3),l(),e.socket.emit("keyUp",{delta:(u.startTime-u.upTime)/1e3,position:null,role:u.role})),u.isPressed=!1}())}),!1)),o===ROLE_OPPONENT&&(function(){if(!e.edges)throw new Error("Boom");var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"circle");switch(n.setAttribute("r","1"),function(t){var e=t.length;return t[Math.floor(Math.random()*e)]}([0,1,2,3])){case 0:n.setAttribute("cx","160"),n.setAttribute("cy","0"),u.opponentPoints.push([160,0]);break;case 1:n.setAttribute("cx","100"),n.setAttribute("cy","0"),u.opponentPoints.push([100,0]);break;case 2:n.setAttribute("cx","100"),n.setAttribute("cy","320"),u.opponentPoints.push([100,320]);break;case 3:n.setAttribute("cx","160"),n.setAttribute("cy","200"),u.opponentPoints.push([160,200])}e.edges.appendChild(n);var o=document.createElementNS(t,"polygon");e.edges.appendChild(o)}(),function(){if(!e.edges)throw new Error("Boom");var t=e.edges.children[0],n=e.edges.children[1];document.body.addEventListener("keyup",(function(o){switch(o.code){case"ArrowUp":o.preventDefault(),function(t){var e=t.getAttribute("cy");if(null===e)throw new Error("Boom");(e=parseInt(e,10))>0&&t.setAttribute("cy",Math.max(e-2,0)+"")}(t);break;case"ArrowRight":o.preventDefault(),function(t){var e=t.getAttribute("cx");if(null===e)throw new Error("Boom");(e=parseInt(e,10))<=320&&t.setAttribute("cx",Math.min(e+3.2,320)+"")}(t);break;case"ArrowDown":o.preventDefault(),function(t){var e=t.getAttribute("cy");if(null===e)throw new Error("Boom");(e=parseInt(e,10))<=200&&t.setAttribute("cy",Math.min(e+2,200)+"")}(t);break;case"ArrowLeft":o.preventDefault(),function(t){var e=t.getAttribute("cx");if(null===e)throw new Error("Boom");(e=parseInt(e,10))>0&&t.setAttribute("cx",Math.max(e-3.2,0)+"")}(t)}var r=t.getAttribute("cx"),i=t.getAttribute("cy");if(r&&i){u.opponentPoints.push([r,i]);var s=u.opponentPoints.map((function(t){return t.join(",")})).join(" ");n.setAttribute("points",s),e.socket.emit("keyUp",{delta:null,position:{cx:r,cy:i},role:u.role})}window.zzfx.apply(window,[,,350,,,.09,4,1.13,,6.9,,,,.9,,.5,,.93,.01,.18])}),!1)}()),n("Playing")}function f(t){var n=t.delta,o=t.position,r=t.role;if(r===ROLE_HOST&&(u.hostPoints.push(n),l()),r===ROLE_OPPONENT&&e.edges){var i;if(0===e.edges.children.length){var s="http://www.w3.org/2000/svg";(i=document.createElementNS(s,"circle")).setAttribute("r","1"),e.edges.append(i);var a=document.createElementNS(s,"polygon");e.edges.appendChild(a)}else i=e.edges.children[0];var c=o.cx,p=o.cy;i.setAttribute("cx",c),i.setAttribute("cy",p),u.opponentPoints.push([parseInt(c,10),parseInt(p,10)]),function(){if(!e.edges)throw new Error("Boom");var t=e.edges.children[1];if(!t)throw new Error("Boom");var n=u.opponentPoints.map((function(t){return t.join(",")})).join(" ");t.setAttribute("points",n)}()}}function w(){a("You win!")}function h(){u.hostPoints=[],e.socket=window.io({upgrade:!1,transports:["websocket"]}),function(t){t.host=function(){var t=document.getElementById("host");if(!t)throw new Error("Cannot start game!");return t}(),t.edges=function(){var t=document.getElementById("edges");if(!t)throw new Error("Cannot start game!");return t.innerHTML="",t}(),t.socketState=function(){var t=document.getElementById("socketState");if(!t)throw new Error("Cannot start game!");return t}(),t.roleState=function(){var t=document.getElementById("role");if(!t)throw new Error("Cannot start game!");return t}(),t.opponentsState=function(){var t=document.getElementById("opponents");if(!t)throw new Error("Cannot start game!");return t}(),t.spectatorsState=function(){var t=document.getElementById("spectators");if(!t)throw new Error("Cannot start game!");return t}()}(e),function(){if(null===e.socket)throw new Error("Game not properly initialised!");e.socket.on("start",d),e.socket.on("sync",f),e.socket.on("win",w),e.socket.on("lose",c),e.socket.on("end",i),e.socket.on("connect",o),e.socket.on("disconnect",r),e.socket.on("error",s)}(),u.startTime=(new Date).valueOf(),l()}return t.app=function(){window.addEventListener("load",h,!1)},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
