/**
 * This file is part of JS13kGames - SPACE.
 * Lido Space is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * Lido Space is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * You should have received a copy of the GNU General Public License
 * along with Lido Space.  If not, see <https://www.gnu.org/licenses/>.
 */

var lido=function(t){"use strict";var n={downTime:0,host:null,isPressed:!1,opponentsState:null,points:[],roleState:null,socket:null,socketState:null,spectatorsState:null,startTime:0,upTime:0};function e(t){if(null===n.socketState)throw new Error("HTML broken");console.log(t),n.socketState.textContent=t}function o(){e("Connected and waiting for opponent…")}function r(){e("Connection lost!")}function s(){e("Waiting for opponent…")}function a(){e("Connection error!")}function i(t){console.log(t)}function c(){i("You lost")}function u(){n.isPressed||(n.downTime=(new Date).valueOf(),n.isPressed=!0)}function l(){var t=[160,100],e=[].concat([t]);return n.points.forEach((function(n){var o,r=t[0],s=t[1],a=function(t){var n=t.radius,e=t.angle;return{x:n*Math.cos(e),y:n*Math.sin(e)}}({radius:130*Math.random(),angle:(o=360*n/13,o*Math.PI/180)}),i=a.x,c=a.y;e.push([r+i,s+c]),e.push([r,s])})),e.slice(-26)}function p(){if(null===n.host)throw new Error("Game not properly initialised!");var t=l().map((function(t){return t.join(",")})).join(" ");n.host.setAttribute("points",t)}function d(){n.upTime=(new Date).valueOf();var t=n.upTime-n.downTime;Number.isNaN(t/1e3)||(n.points.push((n.startTime-n.upTime)/1e3),p(),n.socket.emit("keyUp",{delta:(n.startTime-n.upTime)/1e3})),n.isPressed=!1}function f(t){var o=t.role;!function(t){var e=t.role,o=t.opponents,r=t.spectators;if(!n.opponentsState||!n.roleState||!n.spectatorsState)throw new Error("Bogus HTML");n.roleState.textContent=e,n.opponentsState.textContent=o,n.spectatorsState.textContent=r}({role:o,opponents:t.opponents,spectators:t.spectators}),o===ROLE_HOST&&(document.body.addEventListener("keydown",u,!1),document.body.addEventListener("keyup",d,!1)),e("Playing")}function m(){i("You win!")}function w(t){n.points.push(t.delta),p()}function h(){n.points=[],n.socket=window.io({upgrade:!1,transports:["websocket"]}),function(t){var n=document.getElementById("host");if(!n)throw new Error("Cannot start game!");t.host=n}(n),function(t){t.socketState=function(){var t=document.getElementById("socketState");if(!t)throw new Error("Cannot start game!");return t}(),t.roleState=function(){var t=document.getElementById("role");if(!t)throw new Error("Cannot start game!");return t}(),t.opponentsState=function(){var t=document.getElementById("opponents");if(!t)throw new Error("Cannot start game!");return t}(),t.spectatorsState=function(){var t=document.getElementById("spectators");if(!t)throw new Error("Cannot start game!");return t}()}(n),function(){if(null===n.socket)throw new Error("Game not properly initialised!");n.socket.on("start",f),n.socket.on("sync",w),n.socket.on("win",m),n.socket.on("lose",c),n.socket.on("end",s),n.socket.on("connect",o),n.socket.on("disconnect",r),n.socket.on("error",a)}(),n.startTime=(new Date).valueOf(),p()}return t.app=function(){window.addEventListener("load",h,!1)},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
